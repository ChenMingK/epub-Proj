# 需求分析
<span><img src="https://github.com/ChenMingK/ImagesStore/blob/master/imgs/epubProj20.png" width=300px></span>&emsp;
<span><img src="https://github.com/ChenMingK/ImagesStore/blob/master/imgs/epubProj19.png" width=400px></span>

1.书城首页上方是标题和搜索组件，右上方为随机推荐按钮，点击后随机推荐一本图书<br>
2.下方由猜你喜欢、随机推荐、图书分类等板块构成<br>
3.点击展示的图书封面跳转到对应的图书详情页<br>

# 组件关系
<img src="https://github.com/ChenMingK/ImagesStore/blob/master/imgs/epubProj21.png">

# 主要技术难点
## 推荐动画的实现
<img src="https://github.com/ChenMingK/ImagesStore/blob/master/imgs/flapcard.gif.gif" width=300px><br>
上图为用JS实现的卡片翻转的帧动画，项目中整个推荐动画分为4个部分：<br>
1.卡片登场动画（CSS3实现）<br>
2.卡片翻转动画（JS实现）<br>
3.烟花动画（CSS3实现）<br>
这里先介绍卡片翻转动画的实现，这个我也单独做了个demo，<a href="">走你</a>建议配合代码看<br>
动画的大致流程如下：每两张圆形卡片为一组，上面的圆称为正面，下面的圆称为背面，每个卡片又分为左右两个部分；正面的圆
的右半部分首先进行转动（且颜色逐渐加深），同时背面的圆的左边部分同时进行转动（背面的左边部分要先与右边部分重叠）；当转动90度的时候，
背面圆的左边会覆盖正面圆的右边，且颜色有一个由深变浅的效果。转完一个180度后切换到下一组卡片。

### 实现要点
1.卡片数据抽离<br>
把每张卡片的数据抽离出来便于操作

``` javaScript
export const flapCardList = [
{
  r: 255,
  g: 102,
  _g: 102,  // 要改动的颜色，原始值用于还原
  b: 159,
  imgLeft: 'url(' + require('@/assets/images/gift-left.png') + ')',
  imgRight: 'url(' + require('@/assets/images/gift-right.png') + ')',
  backgroundSize: '50% 50%', // 控制背景大小, 以父元素的百分比来设置图像的宽度和高度
  zIndex: 100,               // 控制卡片位置
  rotateDegree: 0            // 转动角度
},
```
2.转动轴的设置<br>
使用CSS的*transform-origin*属性，默认是center，这里左半圆的转动轴应该是right，右半圆的转动轴为left才能实现沿着中间轴转动的效果。

3.*backface-visibility*属性<br>
该CSS属性用于隐藏被旋转的div元素的背面，注意一个元素它转过90度后就为“背面”。<br>
0\~90：正面<br>
90\~270：背面<br>
270\~360：正面<br>

4.临界点的设置及及如何实现覆盖<br>
必须在某一个临界点让下面的元素的z-index大于上面的<br>
临界点：90度，当右边的半圆转过90度的时候，下面的半圆要覆盖上面的<br>
**对于正面元素来说，是右半圆每次+10度进行转动，对背面元素而言，最初左半圆要和右半圆重叠（先rotateY(180deg)），然后在正面元素转动的同时它每次-10度**

5.颜色的平衡<br>
背面元素的左侧卡片颜色值要预先减少（转动时是逐渐增加的），如果不预先减少就多了90度那一部分的颜色增加，会导致颜色的不平衡

颜色平衡的目标：正面元素右侧卡片0\~90度旋转时颜色逐渐加深，90度临界值后背面元素的左侧卡片覆盖正面元素的右侧卡片（且此时其处于深色状态），
然后90\~180度背面元素的左侧卡片颜色逐渐变浅，转为水平后与初始颜色一致（背面元素的右侧卡片）

6.如何设置z-index<br>
这个有很多种方案，只要保证当前一组卡片中正面的z-index在所有卡片中最大，背面的其次即可。

``` javaScript
// 动态设置zIndex, 实现下列目标
// 100 -> 96
// 99 -> 100
// 98 -> 99
// 97 -> 98
// 96 -> 97
// (0 - 1 + 5) % 5 = 4 -> 100 - 4 = 96
// (1 - 1 + 5) % 5 = 0 -> 100 - 0 = 100 
this.flapCardList.forEach((item, index) => {
  item.zIndex = 100 - ((index - this.front + len) % len)
})
```
